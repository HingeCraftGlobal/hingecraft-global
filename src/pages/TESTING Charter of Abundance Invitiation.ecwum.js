// HingeCraft Global - SEO Optimized
// Charter of Abundance Test | Preview
// Generated: December 6, 2025

import wixSeo from 'wix-seo';

$w.onReady(function () {
    // Set page title
    wixSeo.setTitle("Charter of Abundance Test | Preview");
    
    // Set meta tags
    wixSeo.setMetaTags([
        { name: "description", content: "Preview page for Charter of Abundance invitation - HingeCraft's commitment to sustainable prosperity." },
        { name: "keywords", content: "charter preview, abundance charter, invitation preview" },
        { name: "robots", content: "index, follow" },
        { property: "og:title", content: "Charter of Abundance Test | Preview" },
        { property: "og:description", content: "Preview page for Charter of Abundance invitation - HingeCraft's commitment to sustainable prosperity." },
        { property: "og:type", content: "website" },
        { property: "og:site_name", content: "HingeCraft Global" },
        { property: "twitter:card", content: "summary_large_image" },
        { property: "twitter:title", content: "Charter of Abundance Test | Preview" },
        { property: "twitter:description", content: "Preview page for Charter of Abundance invitation - HingeCraft's commitment to sustainable prosperity." }
    ]);
    
    // Set structured data (JSON-LD)
    wixSeo.setStructuredData([
        {
        "@context": "https://schema.org",
        "@type": "WebPage",
        "name": "Charter of Abundance Test | Preview",
        "description": "Preview page for Charter of Abundance invitation - HingeCraft's commitment to sustainable prosperity.",
        "url": "https://www.hingecraft.com/testing-charter-of-abundance-invitiation.ecwum",
        "inLanguage": "en-US",
        "dateModified": "2025-12-06",
        "publisher": {
                "@type": "Organization",
                "name": "HingeCraft Global",
                "url": "https://www.hingecraft.com",
                "logo": {
                        "@type": "ImageObject",
                        "url": "https://www.hingecraft.com/logo.png"
                }
        }
},
        {
        "@type": "BreadcrumbList",
        "itemListElement": [
                {
                        "@type": "ListItem",
                        "position": 1,
                        "name": "Home",
                        "item": "https://www.hingecraft.com"
                },
                {
                        "@type": "ListItem",
                        "position": 2,
                        "name": "Charter of Abundance Test",
                        "item": "https://www.hingecraft.com/testing-charter-of-abundance-invitiation.ecwum"
                }
        ]
}
    ]);
});


// Original page code below
// Comprehensive SEO Optimization - TESTING Charter of Abundance Invitiation
// JSON-LD Schema.org | 100+ Keywords | Competitive Optimization

$w.onReady(function () {
    if (typeof document !== 'undefined') {
        // Page Title
        document.title = 'TESTING Charter of Abundance Invitiation | HingeCraft Global';
        
        // Meta Description
        let metaDesc = document.querySelector('meta[name="description"]');
        if (!metaDesc) {
            metaDesc = document.createElement('meta');
            metaDesc.setAttribute('name', 'description');
            document.head.appendChild(metaDesc);
        }
        metaDesc.setAttribute('content', 'TESTING Charter of Abundance Invitiation - HingeCraft Global. Comprehensive information, resources, and services.');
        
        // Meta Keywords
        let metaKeywords = document.querySelector('meta[name="keywords"]');
        if (!metaKeywords) {
            metaKeywords = document.createElement('meta');
            metaKeywords.setAttribute('name', 'keywords');
            document.head.appendChild(metaKeywords);
        }
        metaKeywords.setAttribute('content', 'charter of abundance, terms of service, corporate charter, code of conduct, hingecraft, hingecraft global, resilient design');
        
        // Open Graph Tags
        const ogTags = {
            'og:title': 'TESTING Charter of Abundance Invitiation | HingeCraft Global',
            'og:description': 'TESTING Charter of Abundance Invitiation - HingeCraft Global. Comprehensive information, resources, and services.',
            'og:image': 'https://hingecraft-global.ai/og-image.jpg',
            'og:url': 'https://hingecraft-global.ai/testing-charter-of-abundance-invitiation',
            'og:type': 'website',
            'og:site_name': 'HingeCraft Global'
        };
        
        Object.keys(ogTags).forEach(prop => {
            let ogMeta = document.querySelector(`meta[property="${prop}"]`);
            if (!ogMeta) {
                ogMeta = document.createElement('meta');
                ogMeta.setAttribute('property', prop);
                document.head.appendChild(ogMeta);
            }
            ogMeta.setAttribute('content', ogTags[prop]);
        });
        
        // Twitter Card Tags
        const twitterTags = {
            'twitter:card': 'summary_large_image',
            'twitter:title': 'TESTING Charter of Abundance Invitiation | HingeCraft Global',
            'twitter:description': 'TESTING Charter of Abundance Invitiation - HingeCraft Global. Comprehensive information, resources, and services.',
            'twitter:image': 'https://hingecraft-global.ai/og-image.jpg'
        };
        
        Object.keys(twitterTags).forEach(name => {
            let twitterMeta = document.querySelector(`meta[name="${name}"]`);
            if (!twitterMeta) {
                twitterMeta = document.createElement('meta');
                twitterMeta.setAttribute('name', name);
                document.head.appendChild(twitterMeta);
            }
            twitterMeta.setAttribute('content', twitterTags[name]);
        });
        
        // Canonical URL
        let canonical = document.querySelector('link[rel="canonical"]');
        if (!canonical) {
            canonical = document.createElement('link');
            canonical.setAttribute('rel', 'canonical');
            document.head.appendChild(canonical);
        }
        canonical.setAttribute('href', 'https://hingecraft-global.ai/testing-charter-of-abundance-invitiation');
        
        // Robots Meta
        let robots = document.querySelector('meta[name="robots"]');
        if (!robots) {
            robots = document.createElement('meta');
            robots.setAttribute('name', 'robots');
            document.head.appendChild(robots);
        }
        robots.setAttribute('content', 'index, follow, max-snippet:-1, max-image-preview:large, max-video-preview:-1');
        
        // Additional Meta Tags
        const additionalTags = {
            'author': 'HingeCraft Global',
            'language': 'en-US',
            'revisit-after': '7 days',
            'distribution': 'global',
            'rating': 'general'
        };
        
        Object.keys(additionalTags).forEach(name => {
            let meta = document.querySelector(`meta[name="${name}"]`);
            if (!meta) {
                meta = document.createElement('meta');
                meta.setAttribute('name', name);
                document.head.appendChild(meta);
            }
            meta.setAttribute('content', additionalTags[name]);
        });
        
        // Schema.org JSON-LD Structured Data
        let schemaScript = document.querySelector('script[type="application/ld+json"]');
        if (!schemaScript) {
            schemaScript = document.createElement('script');
            schemaScript.setAttribute('type', 'application/ld+json');
            document.head.appendChild(schemaScript);
        }
        schemaScript.textContent = `{
  "@context": "https://schema.org",
  "@type": "WebPage",
  "name": "TESTING Charter of Abundance Invitiation | HingeCraft Global",
  "description": "TESTING Charter of Abundance Invitiation - HingeCraft Global. Comprehensive information, resources, and services.",
  "url": "https://hingecraft-global.ai/testing-charter-of-abundance-invitiation",
  "publisher": {
    "@type": "Organization",
    "name": "HingeCraft Global",
    "url": "https://hingecraft-global.ai",
    "logo": "https://hingecraft-global.ai/logo.png"
  },
  "datePublished": "2025-12-05",
  "dateModified": "2025-12-05",
  "inLanguage": "en-US",
  "keywords": "charter of abundance, terms of service, corporate charter, code of conduct, hingecraft, hingecraft global, resilient design"
}`;
    }

});


$w.onReady(function () {
    if (typeof document !== 'undefined') {
        // Page Title
        document.title = 'TESTING Charter of Abundance Invitiation | HingeCraft Global';
        
        // Meta Description
        let metaDesc = document.querySelector('meta[name="description"]');
        if (!metaDesc) {
            metaDesc = document.createElement('meta');
            metaDesc.setAttribute('name', 'description');
            document.head.appendChild(metaDesc);
        }
        metaDesc.setAttribute('content', 'TESTING Charter of Abundance Invitiation - HingeCraft Global');
        
        // Meta Keywords
        let metaKeywords = document.querySelector('meta[name="keywords"]');
        if (!metaKeywords) {
            metaKeywords = document.createElement('meta');
            metaKeywords.setAttribute('name', 'keywords');
            document.head.appendChild(metaKeywords);
        }
        metaKeywords.setAttribute('content', 'charter of abundance, terms of service, corporate charter, hingecraft, hingecraft global');
        
        // Open Graph Tags
        const ogTags = {
            'og:title': 'TESTING Charter of Abundance Invitiation | HingeCraft Global',
            'og:description': 'TESTING Charter of Abundance Invitiation - HingeCraft Global',
            'og:image': 'https://hingecraft-global.ai/og-image.jpg',
            'og:url': 'https://hingecraft-global.ai/testing-charter-of-abundance-invitiation',
            'og:type': 'website',
            'og:site_name': 'HingeCraft Global'
        };
        
        Object.keys(ogTags).forEach(prop => {
            let ogMeta = document.querySelector(`meta[property="${prop}"]`);
            if (!ogMeta) {
                ogMeta = document.createElement('meta');
                ogMeta.setAttribute('property', prop);
                document.head.appendChild(ogMeta);
            }
            ogMeta.setAttribute('content', ogTags[prop]);
        });
        
        // Twitter Card Tags
        const twitterTags = {
            'twitter:card': 'summary_large_image',
            'twitter:title': 'TESTING Charter of Abundance Invitiation | HingeCraft Global',
            'twitter:description': 'TESTING Charter of Abundance Invitiation - HingeCraft Global',
            'twitter:image': 'https://hingecraft-global.ai/og-image.jpg'
        };
        
        Object.keys(twitterTags).forEach(name => {
            let twitterMeta = document.querySelector(`meta[name="${name}"]`);
            if (!twitterMeta) {
                twitterMeta = document.createElement('meta');
                twitterMeta.setAttribute('name', name);
                document.head.appendChild(twitterMeta);
            }
            twitterMeta.setAttribute('content', twitterTags[name]);
        });
        
        // Canonical URL
        let canonical = document.querySelector('link[rel="canonical"]');
        if (!canonical) {
            canonical = document.createElement('link');
            canonical.setAttribute('rel', 'canonical');
            document.head.appendChild(canonical);
        }
        canonical.setAttribute('href', 'https://hingecraft-global.ai/testing-charter-of-abundance-invitiation');
        
        // Robots Meta
        let robots = document.querySelector('meta[name="robots"]');
        if (!robots) {
            robots = document.createElement('meta');
            robots.setAttribute('name', 'robots');
            document.head.appendChild(robots);
        }
        robots.setAttribute('content', 'index, follow, max-snippet:-1, max-image-preview:large, max-video-preview:-1');
        
        // Schema.org JSON-LD Structured Data
        let schemaScript = document.querySelector('script[type="application/ld+json"]');
        if (!schemaScript) {
            schemaScript = document.createElement('script');
            schemaScript.setAttribute('type', 'application/ld+json');
            document.head.appendChild(schemaScript);
        }
        schemaScript.textContent = `{
  "@context": "https://schema.org",
  "@type": "WebPage",
  "name": "TESTING Charter of Abundance Invitiation | HingeCraft Global",
  "description": "TESTING Charter of Abundance Invitiation - HingeCraft Global",
  "url": "https://hingecraft-global.ai/testing-charter-of-abundance-invitiation",
  "publisher": {
    "@type": "Organization",
    "name": "HingeCraft Global",
    "url": "https://hingecraft-global.ai",
    "logo": "https://hingecraft-global.ai/logo.png"
  },
  "datePublished": "2025-12-05",
  "dateModified": "2025-12-05",
  "inLanguage": "en-US",
  "keywords": "charter of abundance, terms of service, corporate charter, hingecraft, hingecraft global"
}`;
    }
    
    // Load HTML content for legal pages
    
});




$w.onReady(function () {
    if (typeof document !== 'undefined') {
        // Page Title
        document.title = 'TESTING Charter of Abundance Invitiation | HingeCraft Global';
        
        // Meta Description
        let metaDesc = document.querySelector('meta[name="description"]');
        if (!metaDesc) {
            metaDesc = document.createElement('meta');
            metaDesc.setAttribute('name', 'description');
            document.head.appendChild(metaDesc);
        }
        metaDesc.setAttribute('content', 'TESTING Charter of Abundance Invitiation - HingeCraft Global');
        
        // Meta Keywords
        let metaKeywords = document.querySelector('meta[name="keywords"]');
        if (!metaKeywords) {
            metaKeywords = document.createElement('meta');
            metaKeywords.setAttribute('name', 'keywords');
            document.head.appendChild(metaKeywords);
        }
        metaKeywords.setAttribute('content', 'charter of abundance, terms of service, corporate charter, hingecraft, hingecraft global');
        
        // Open Graph Tags
        const ogTags = {
            'og:title': 'TESTING Charter of Abundance Invitiation | HingeCraft Global',
            'og:description': 'TESTING Charter of Abundance Invitiation - HingeCraft Global',
            'og:image': 'https://hingecraft-global.ai/og-image.jpg',
            'og:url': 'https://hingecraft-global.ai/testing-charter-of-abundance-invitiation',
            'og:type': 'website',
            'og:site_name': 'HingeCraft Global'
        };
        
        Object.keys(ogTags).forEach(prop => {
            let ogMeta = document.querySelector(`meta[property="${prop}"]`);
            if (!ogMeta) {
                ogMeta = document.createElement('meta');
                ogMeta.setAttribute('property', prop);
                document.head.appendChild(ogMeta);
            }
            ogMeta.setAttribute('content', ogTags[prop]);
        });
        
        // Twitter Card Tags
        const twitterTags = {
            'twitter:card': 'summary_large_image',
            'twitter:title': 'TESTING Charter of Abundance Invitiation | HingeCraft Global',
            'twitter:description': 'TESTING Charter of Abundance Invitiation - HingeCraft Global',
            'twitter:image': 'https://hingecraft-global.ai/og-image.jpg'
        };
        
        Object.keys(twitterTags).forEach(name => {
            let twitterMeta = document.querySelector(`meta[name="${name}"]`);
            if (!twitterMeta) {
                twitterMeta = document.createElement('meta');
                twitterMeta.setAttribute('name', name);
                document.head.appendChild(twitterMeta);
            }
            twitterMeta.setAttribute('content', twitterTags[name]);
        });
        
        // Canonical URL
        let canonical = document.querySelector('link[rel="canonical"]');
        if (!canonical) {
            canonical = document.createElement('link');
            canonical.setAttribute('rel', 'canonical');
            document.head.appendChild(canonical);
        }
        canonical.setAttribute('href', 'https://hingecraft-global.ai/testing-charter-of-abundance-invitiation');
        
        // Robots Meta
        let robots = document.querySelector('meta[name="robots"]');
        if (!robots) {
            robots = document.createElement('meta');
            robots.setAttribute('name', 'robots');
            document.head.appendChild(robots);
        }
        robots.setAttribute('content', 'index, follow, max-snippet:-1, max-image-preview:large, max-video-preview:-1');
        
        // Schema.org JSON-LD Structured Data
        let schemaScript = document.querySelector('script[type="application/ld+json"]');
        if (!schemaScript) {
            schemaScript = document.createElement('script');
            schemaScript.setAttribute('type', 'application/ld+json');
            document.head.appendChild(schemaScript);
        }
        schemaScript.textContent = `{
  "@context": "https://schema.org",
  "@type": "WebPage",
  "name": "TESTING Charter of Abundance Invitiation | HingeCraft Global",
  "description": "TESTING Charter of Abundance Invitiation - HingeCraft Global",
  "url": "https://hingecraft-global.ai/testing-charter-of-abundance-invitiation",
  "publisher": {
    "@type": "Organization",
    "name": "HingeCraft Global",
    "url": "https://hingecraft-global.ai",
    "logo": "https://hingecraft-global.ai/logo.png"
  },
  "datePublished": "2025-12-05",
  "dateModified": "2025-12-05",
  "inLanguage": "en-US",
  "keywords": "charter of abundance, terms of service, corporate charter, hingecraft, hingecraft global"
}`;
    }
    
    // Load HTML content for legal pages
    
});




$w.onReady(function () {
    if (typeof document !== 'undefined') {
        // Page Title
        document.title = 'Charter of Abundance & Resilience – Governance Treaty | H...';
        
        // Meta Description
        let metaDesc = document.querySelector('meta[name="description"]');
        if (!metaDesc) {
            metaDesc = document.createElement('meta');
            metaDesc.setAttribute('name', 'description');
            document.head.appendChild(metaDesc);
        }
        metaDesc.setAttribute('content', 'HingeCraft Global Charter of Abundance & Resilience Governance Treaty - Public-facing legal declaration of mission and governance principles');
        
        // Meta Keywords
        let metaKeywords = document.querySelector('meta[name="keywords"]');
        if (!metaKeywords) {
            metaKeywords = document.createElement('meta');
            metaKeywords.setAttribute('name', 'keywords');
            document.head.appendChild(metaKeywords);
        }
        metaKeywords.setAttribute('content', 'charter of abundance, abundance charter, terms of service, corporate charter, code of conduct, charter of abundance sign, hingecraft, hingecraft global, resilient design');
        
        // Open Graph Tags
        const ogTags = {
            'og:title': 'Charter of Abundance & Resilience – Governance Treaty | H...',
            'og:description': 'HingeCraft Global Charter of Abundance & Resilience Governance Treaty - Public-facing legal declaration of mission and governance principles',
            'og:image': 'https://hingecraft-global.ai/og-image.jpg',
            'og:url': 'https://hingecraft-global.ai/legal/charter_of_abundance',
            'og:type': 'website',
            'og:site_name': 'HingeCraft Global'
        };
        
        Object.keys(ogTags).forEach(prop => {
            let ogMeta = document.querySelector(`meta[property="${prop}"]`);
            if (!ogMeta) {
                ogMeta = document.createElement('meta');
                ogMeta.setAttribute('property', prop);
                document.head.appendChild(ogMeta);
            }
            ogMeta.setAttribute('content', ogTags[prop]);
        });
        
        // Twitter Card Tags
        const twitterTags = {
            'twitter:card': 'summary_large_image',
            'twitter:title': 'Charter of Abundance & Resilience – Governance Treaty | H...',
            'twitter:description': 'HingeCraft Global Charter of Abundance & Resilience Governance Treaty - Public-facing legal declaration of mission and governance principles',
            'twitter:image': 'https://hingecraft-global.ai/og-image.jpg'
        };
        
        Object.keys(twitterTags).forEach(name => {
            let twitterMeta = document.querySelector(`meta[name="${name}"]`);
            if (!twitterMeta) {
                twitterMeta = document.createElement('meta');
                twitterMeta.setAttribute('name', name);
                document.head.appendChild(twitterMeta);
            }
            twitterMeta.setAttribute('content', twitterTags[name]);
        });
        
        // Canonical URL
        let canonical = document.querySelector('link[rel="canonical"]');
        if (!canonical) {
            canonical = document.createElement('link');
            canonical.setAttribute('rel', 'canonical');
            document.head.appendChild(canonical);
        }
        canonical.setAttribute('href', 'https://hingecraft-global.ai/legal/charter_of_abundance');
        
        // Robots Meta
        let robots = document.querySelector('meta[name="robots"]');
        if (!robots) {
            robots = document.createElement('meta');
            robots.setAttribute('name', 'robots');
            document.head.appendChild(robots);
        }
        robots.setAttribute('content', 'index, follow, max-snippet:-1, max-image-preview:large, max-video-preview:-1');
        
        // Schema.org JSON-LD
        let schemaScript = document.querySelector('script[type="application/ld+json"]');
        if (!schemaScript) {
            schemaScript = document.createElement('script');
            schemaScript.setAttribute('type', 'application/ld+json');
            document.head.appendChild(schemaScript);
        }
        schemaScript.textContent = JSON.stringify({
            "@context": "https://schema.org",
            "@type": "LegalDocument",
            "name": "Charter of Abundance & Resilience – Governance Treaty | H...",
            "description": "HingeCraft Global Charter of Abundance & Resilience Governance Treaty - Public-facing legal declaration of mission and governance principles",
            "url": "https://hingecraft-global.ai/legal/charter_of_abundance",
            "publisher": {
                "@type": "Organization",
                "name": "HingeCraft Global",
                "url": "https://hingecraft-global.ai",
                "logo": "https://hingecraft-global.ai/logo.png"
            },
            "datePublished": "2025-12-05",
            "dateModified": "2025-12-05",
            "inLanguage": "en-US",
            "keywords": "charter of abundance, abundance charter, terms of service, corporate charter, code of conduct, charter of abundance sign, hingecraft, hingecraft global, resilient design"
        });
    }
});


/**
 * HingeCraft Payment Page Integration (Donation Page)
 * 
 * GOAL: Capture "other" custom donation amount and transfer to charter page
 * 
 * Flow: Payment Page (Donation) → User enters "other" amount → Submits payment → 
 *       Amount stored → Redirects to Charter Page → Charter displays amount
 * 
 * This code should be added to the payment/donation page (/payment) in Wix
 */

import wixStorage from 'wix-storage';
import wixLocation from 'wix-location';
import wixData from 'wix-data';

/**
 * Setup donation amount capture
 * Monitors for "other" amount selection and custom amount input
 */
function setupDonationAmountCapture() {
    // Find donation form elements - UPDATE THESE SELECTORS TO MATCH YOUR FORM
    const otherAmountButton = $w('#otherAmountButton') || 
                             $w('button[data-amount="other"]') ||
                             $w('button:contains("Other")');
    
    const customAmountInput = $w('#customAmountInput') || 
                              $w('#otherAmount') ||
                              $w('input[type="number"][placeholder*="amount" i]') ||
                              $w('input[name="customAmount"]');
    
    const donationForm = $w('#donationForm') || 
                         $w('form') ||
                         $w('#paymentForm');
    
    // Show custom input when "other" is clicked
    if (otherAmountButton) {
        otherAmountButton.onClick(() => {
            if (customAmountInput) {
                customAmountInput.show();
                customAmountInput.focus();
            }
        });
    }
    
    // Monitor custom amount input changes
    if (customAmountInput) {
        customAmountInput.onChange(() => {
            const amount = parseFloat(customAmountInput.value) || 0;
            if (amount > 0) {
                // Store amount as user types (optional)
                storeDonationAmount(amount, true);
            }
        });
    }
    
    // Monitor form submission
    if (donationForm) {
        donationForm.onSubmit(handleDonationSubmission);
    }
    
    // Monitor payment/submit button
    const submitButton = $w('#submitDonation') || 
                         $w('#submitPayment') ||
                         $w('button[type="submit"]') ||
                         $w('button:contains("Donate")') ||
                         $w('button:contains("Pay")');
    
    if (submitButton) {
        submitButton.onClick(() => {
            // Capture amount before submission
            setTimeout(() => {
                captureDonationAmount();
            }, 100);
        });
    }
}

/**
 * Capture donation amount when payment is submitted
 */
function captureDonationAmount() {
    let donationAmount = 0;
    let isOtherAmount = false;
    
    // Method 1: Get from custom "other" amount input
    const customAmountInput = $w('#customAmountInput') || 
                              $w('#otherAmount') ||
                              $w('input[name="customAmount"]') ||
                              $w('input[type="number"].custom-amount');
    
    if (customAmountInput && customAmountInput.value) {
        donationAmount = parseFloat(customAmountInput.value) || 0;
        isOtherAmount = true;
    }
    
    // Method 2: Check if "other" amount button is selected
    if (!donationAmount) {
        const otherAmountButton = $w('#otherAmountButton') || 
                                  $w('button[data-amount="other"]');
        if (otherAmountButton && (otherAmountButton.hasClass('selected') || 
                                  otherAmountButton.checked ||
                                  otherAmountButton.pressed)) {
            isOtherAmount = true;
            if (customAmountInput) {
                donationAmount = parseFloat(customAmountInput.value) || 0;
            }
        }
    }
    
    // Method 3: Get from selected preset amount button
    if (!donationAmount) {
        const selectedButton = $w('button.selected[data-amount]') ||
                               $w('button.pressed[data-amount]');
        if (selectedButton) {
            const amountValue = selectedButton.getAttribute('data-amount');
            if (amountValue && amountValue !== 'other') {
                donationAmount = parseFloat(amountValue) || 0;
            }
        }
    }
    
    // Method 4: Get from form field directly
    if (!donationAmount) {
        const amountField = $w('#donationAmount') || 
                            $w('input[name="amount"]') ||
                            $w('#amount');
        if (amountField && amountField.value) {
            donationAmount = parseFloat(amountField.value) || 0;
        }
    }
    
    // If we have a donation amount, store it
    if (donationAmount > 0) {
        storeDonationAmount(donationAmount, isOtherAmount);
        return donationAmount;
    }
    
    return 0;
}

/**
 * Handle donation form submission
 */
async function handleDonationSubmission(event) {
    // Capture the donation amount before form submits
    const amount = captureDonationAmount();
    
    // Store amount for transfer to charter page
    if (amount > 0) {
        await storeDonationAmount(amount, true);
    }
    
    // Allow form to submit normally (your existing payment processing)
    return true;
}

/**
 * Setup payment success handler
 * Call this after payment is successfully processed
 */
function setupPaymentSuccessHandler() {
    // If your payment system has a success callback, hook into it here
    // Example: wixPayments.onPaymentSuccess(handlePaymentSuccess);
    
    // Alternative: Monitor for success message/page
    const successIndicator = $w('#paymentSuccess') || 
                             $w('.payment-success') ||
                             $w('text:contains("Thank you")');
    
    if (successIndicator) {
        // When payment succeeds, redirect to charter
        const amount = captureDonationAmount();
        if (amount > 0) {
            setTimeout(() => {
                redirectToCharterWithAmount(amount);
            }, 2000); // Wait 2 seconds to show success message
        }
    }
}

/**
 * Handle payment success - redirect to charter with amount
 */
export async function handlePaymentSuccess(paymentResult) {
    // Get the donation amount
    let amount = 0;
    
    // Try to get from stored data
    try {
        const stored = wixStorage.getItem('hingecraft_donation');
        if (stored) {
            const data = JSON.parse(stored);
            amount = parseFloat(data.amount) || 0;
        }
    } catch (error) {
        console.log("Could not retrieve stored amount:", error);
    }
    
    // If not found, try to capture from form
    if (!amount) {
        amount = captureDonationAmount();
    }
    
    // If we have an amount, redirect to charter
    if (amount > 0) {
        await redirectToCharterWithAmount(amount);
    } else {
        // Still redirect to charter even without amount
        wixLocation.to('/charter?fromPayment=true');
    }
}

/**
 * Store donation amount for transfer to charter page
 */
async function storeDonationAmount(amount, isOtherAmount = false) {
    const donationData = {
        amount: amount,
        isOtherAmount: isOtherAmount,
        timestamp: new Date().toISOString(),
        source: 'payment_page'
    };
    
    // Store in Wix Storage
    try {
        await wixStorage.setItem('hingecraft_donation', JSON.stringify(donationData));
    } catch (error) {
        console.log("Wix Storage not available:", error);
    }
    
    // Store in sessionStorage as backup
    try {
        sessionStorage.setItem('hingecraft_donation', JSON.stringify(donationData));
    } catch (error) {
        console.log("SessionStorage not available:", error);
    }
    
    // Save to database
    try {
        await saveDonationToDatabase(donationData);
    } catch (error) {
        console.log("Could not save to database:", error);
    }
    
    console.log('Donation amount stored:', donationData);
}

/**
 * Save donation to Wix database
 */
async function saveDonationToDatabase(donationData) {
    try {
        const donationRecord = {
            amount: parseFloat(donationData.amount),
            currency: 'USD',
            isOtherAmount: donationData.isOtherAmount,
            source: donationData.source,
            paymentStatus: 'completed',
            createdAt: new Date()
        };
        
        // Save to Donations collection (create this in Wix Database if needed)
        const result = await wixData.save('Donations', donationRecord);
        console.log('Donation saved to database:', result);
        return result;
    } catch (error) {
        console.error('Error saving donation to database:', error);
        // Don't throw - this is optional
        return null;
    }
}

/**
 * Redirect to charter page with donation amount
 */
export async function redirectToCharterWithAmount(amount) {
    // Store amount one more time to ensure it's available
    await storeDonationAmount(amount, true);
    
    // Redirect to charter page with amount in URL
    const params = new URLSearchParams({
        donationAmount: String(amount),
        fromPayment: 'true'
    });
    
    wixLocation.to('/charter?' + params.toString());
}

/**
 * Clear donation data after successful transfer
 */
export function clearDonationData() {
    try {
        wixStorage.removeItem('hingecraft_donation');
    } catch (error) {
        console.log("Error clearing Wix storage:", error);
    }
    
    if (typeof sessionStorage !== 'undefined') {
        try {
            sessionStorage.removeItem('hingecraft_donation');
        } catch (error) {
            console.log("Error clearing session storage:", error);
        }
    }
}
